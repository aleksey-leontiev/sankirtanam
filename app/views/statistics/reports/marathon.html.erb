<%= content_for :meta do %>
	<title>Отчет за марафон <%=@year%></title>
	<meta property="og:title" content="Отчет о распространении книг за марафон <%=@year%>"/>
  <meta property="og:site_name" content="sankirtanam.ru"/>
  <meta property="og:description" content='Отображает общее количество распространненых книг за марафон <%=@year%>.'/>
  <meta property="og:image" content="https://sankirtanam-aleksey-leontiev1.c9.io/sankirtanam-logo.png"/>
<% end %>

<% if @no_data then %>
<div class="jumbotron">
  <h1>Отчет за марафон <%=@year%></h1>
  <p class="lead">
    Отображает общее количество распространненых за марафон <%=@year%>.
  </p>
</div>
<div class="alert alert-danger" role="alert">За данный период данных нет.</div>

<% else %>
<div class="jumbotron">
  <h1>Отчет за марафон <%=@year%></h1>
  <p class="lead">
    Отображает общее количество распространненых за марафон <%=@year%>.
    Было распространено <%= @overall_quantity %> книг.
  </p>
</div>

<div class="panel panel-default">
  <div class="panel-heading">Общее количество распространненых книг за марафон <%=@year%> год</div>

  <div class="table-responsive">
    <table class="table">
  		<tr>
  			<th>Локация</th>
  			<th>Книги</th>
  			<th>Очки</th>
  		</tr>

  		<% @locations.each do |row|  %>
  		  <tr>
  		    <td><a href="<%=statistics_reports_monthly_path(row[:location][:url], @year, 12)%>"><%=row[:location][:name]%></a></td>
  		    <td><%=row[:quantity][:books]%></td>
  		    <td><%=row[:quantity][:scores]%></td>
  		  </tr>
  		<% end %>
  	</table>
	</div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">Лидеры распространения книг за марафон <%=@year%> год</div>
  <div class="panel-body">
    <div id="distributors-chart" class="ct-chart ct-double-octave"></div>
  </div>

  <div id="scroller" class="table-responsive">
	  <table id="table" class="table">
  		<tr>
  		  <th>Имя</th><th>Локация</th>
  			<th>Очки</th><th>Книги</th>
  			<th>01</th><th>02</th><th>03</th><th>04</th><th>05</th><th>06</th><th>07</th>
  			<th>08</th><th>09</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th>
  			<th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th>
  			<th>22</th><th>23</th><th>24</th><th>25</th><th>26</th><th>27</th><th>28</th>
  			<th>29</th><th>30</th><th>31</th>
  		</tr>
  		<% @persons.each do |row|  %>
  		  <tr>
  		    <td>
  		      <a href="<%=person_link(row[:person][:id], row[:person][:name], year: @year, month: 12)%>"><%=row[:person][:name]%></a>
  		    </td>
  		    <td class="text-nowrap">
  		      <%=row[:person][:location][:name]%>
  		    </td>
  		    <td><%=row[:quantity][:details][:scores]%></td>
  		    <td><%=row[:quantity][:books]%></td>
  		    <td><%=row[:quantity][:details][:d01]%></td>
  		    <td><%=row[:quantity][:details][:d02]%></td>
  		    <td><%=row[:quantity][:details][:d03]%></td>
  		    <td><%=row[:quantity][:details][:d04]%></td>
  		    <td><%=row[:quantity][:details][:d05]%></td>
  		    <td><%=row[:quantity][:details][:d06]%></td>
  		    <td><%=row[:quantity][:details][:d07]%></td>
  		    <td><%=row[:quantity][:details][:d08]%></td>
  		    <td><%=row[:quantity][:details][:d09]%></td>
  		    <td><%=row[:quantity][:details][:d10]%></td>
  		    <td><%=row[:quantity][:details][:d11]%></td>
  		    <td><%=row[:quantity][:details][:d12]%></td>
  		    <td><%=row[:quantity][:details][:d13]%></td>
  		    <td><%=row[:quantity][:details][:d14]%></td>
  		    <td><%=row[:quantity][:details][:d15]%></td>
  		    <td><%=row[:quantity][:details][:d16]%></td>
  		    <td><%=row[:quantity][:details][:d17]%></td>
  		    <td><%=row[:quantity][:details][:d18]%></td>
  		    <td><%=row[:quantity][:details][:d19]%></td>
  		    <td><%=row[:quantity][:details][:d20]%></td>
  		    <td><%=row[:quantity][:details][:d21]%></td>
  		    <td><%=row[:quantity][:details][:d22]%></td>
  		    <td><%=row[:quantity][:details][:d23]%></td>
  		    <td><%=row[:quantity][:details][:d24]%></td>
  		    <td><%=row[:quantity][:details][:d25]%></td>
  		    <td><%=row[:quantity][:details][:d26]%></td>
  		    <td><%=row[:quantity][:details][:d27]%></td>
  		    <td><%=row[:quantity][:details][:d28]%></td>
  		    <td><%=row[:quantity][:details][:d29]%></td>
  		    <td><%=row[:quantity][:details][:d30]%></td>
  		    <td><%=row[:quantity][:details][:d31]%></td>
  		  </tr>
  		<% end %>
  	</table>
  </div>

	<div class="panel-footer">
    Книг: <%= @overall_quantity %>;
	</div>
</div>

<script type="text/javascript">
  new Chartist.Bar('#distributors-chart', {
    series: <%=raw [@persons.take(15).map{|o| o[:quantity][:overall]}].to_json%>,
    labels: <%=raw @persons.take(15).map{|o| o[:person][:name]}.to_json%>
  });
</script>
<% end %>

<%= render "share" %>

<style>
#scroller {
    overflow-x: scroll;
}
#scroller table {
    /* just a quick hack to make the table overflow the containing div
       your method may differ */
}

#scroller .table.fixedCol {
    width: auto;
    position: absolute;
    /* below styles are specific for borderd Bootstrap tables
       to remove rounded corners on cloned table */
    -webkit-border-top-right-radius: 0px;
    -webkit-border-bottom-right-radius: 0px;
       -moz-border-radius-topright: 0px;
       -moz-border-radius-bottomright: 0px;
            border-top-right-radius: 0px;
            border-bottom-right-radius: 0px;
}
.table.fixedCol th,
.table.fixedCol td {
    /* background is set to white to hide underlaying column
       of original table */
    background: white;
}
</style>

<script>
$('#scroller table').each(function(){
    var table = $(this),
        fixedCol = table.clone(true),
        fixedWidth = table.find('th').eq(0).width(),
        tablePos = table.position();

    // Remove all but the first column from the cloned table
    fixedCol.find('th').not(':eq(0)').remove();
    fixedCol.find('tbody tr').each(function(){
        $(this).find('td').not(':eq(0)').remove();
    });

    // Set positioning so that cloned table overlays
    // first column of original table
    fixedCol.addClass('fixedCol');
    fixedCol.css({
        left: tablePos.left,
        top: tablePos.top
    });

    // Match column width with that of original table
    fixedCol.find('th,td').css('width',fixedWidth+'px');

    $('#scroller').append(fixedCol);
});
</script>