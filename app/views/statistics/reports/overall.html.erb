<!-- overall report introduction -->
<div class="jumbotron">
  <h1>Суммарный отчет</h1>
  <p class="lead">
    Отображает общее количество распространненых книг по всем локациям за все время.
    За всё время было распространено книг <%= @overall_quantity %>.
    Тройка самых активных локаций: <%= three_most_active_locations(@locations) %>.
    Больше всего книг распространили: <%= three_most_active_persons(@persons) %>.
  </p>
</div>

<!-- overall chart and table -->
<div class="panel panel-default">
  <div class="panel-heading">Общее количество распространненых книг по всем локациям за все время</div>
  <div class="panel-body">
    <div id="quantity-chart" class="ct-chart ct-double-octave"></div>
  </div>

	<table id="table" class="table">
		<!-- table header -->
		<tr>
			<th>Локация</th>
			<th>Книги</th>
			<% [3,2,1,0].each do |y| %>
			  <th>
			    <a href="<%=statistics_reports_annual_path(@current_year-y)%>">
			      <%=@current_year - y%>
			     </a>
			  </th>
			<% end %>
		</tr>

		<!-- table rows -->
		<% @locations.each do |row|  %>
			<tr>
			  <!-- location name -->
				<td>
				  <a href="<%=statistics_reports_location_path(row[:location_url], @current_year)%>">
				    <%=row[:location_name]%>
				  </a>
				</td>

				<!-- quantity and scores -->
				<td><%=row[:quantity]%></td>

				<!-- quantity by year -->
				<% row[:data].each do |year_quantity| %>
		      <td><%=year_quantity%></td>
		    <% end %>
			</tr>
		<% end %>
	</table>

	<div class="panel-footer">
    Книг: <%= @overall_quantity %>;
    Локаций: <%= @locations.count  %>;
	</div>
</div>

<!-- overall by person -->
<div class="panel panel-default">
  <div class="panel-heading">Общее количество распространненых книг по распространителям</div>
  <div class="panel-body">
    <div id="distributors-chart" class="ct-chart ct-double-octave"></div>
  </div>

	<table id="table" class="table">
		<!-- table header -->
		<tr>
		  <th>Имя</th>
			<th>Локация</th>
			<th>Книги</th>
			<% [3,2,1,0].each do |y| %>
	      <th>
			    <%=@current_year - y%>
			  </th>
			<% end %>
		</tr>

		<!-- person rows -->
		<% @persons.each do |row|  %>
			<tr>
			  <td>
			  	<a href="<%=statistics_reports_personal_path(row[:person_id], row[:name])%>"><%=row[:name]%></a>
			  </td>
				<td><%=row[:location]%></td>
				<td><%=row[:quantity]%></td>
			  <% row[:data].each do |quantity| %>
		      <td><%=quantity%></td>
		    <% end %>
			</tr>
		<% end %>
	</table>

	<div class="panel-footer">
    Человек: <%= @persons.count %>;
    Книг:    <%= @overall_quantity %>;
    Локаций: <%= @locations.count  %>;
	</div>
</div>


<script type="text/javascript">
  new Chartist.Line('#quantity-chart', {
    labels: <%= raw chart_labels(@data) %>,
    series: [{
      name: 'series-1',
      data: <%= raw chart_data(@data) %>
    }]
  }, {
    fullWidth: true,
    showArea: true,
    showPoint: false,
    series: {
      'series-1': {
        lineSmooth: Chartist.Interpolation.step()
      }
    }
  });

  new Chartist.Bar('#distributors-chart', {
    labels: <%= raw @persons.map { |o| o[:name] }.to_json %>,
    series: <%= raw @persons.map { |o| o[:quantity] }.to_json %>
  }, {
    distributeSeries: true,
    fullWidth: true
  });
</script>